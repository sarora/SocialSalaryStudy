---
title: "Exploratory Data Analysis"
author: "S. Arora, J. Harmse, V. Mulholland"
date: "April 9, 2018"
header-includes:
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \fancyhead[LE,RO]{Social Salary Study}
- \fancyfoot[CO,CE]{DSCI 554 - Experimentation and Causal Inference}
- \fancyfoot[LE,RO]{\thepage}
output: pdf_document
urlcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=F, message=F}
library(tidyverse)
```

# Data Pre-processing

## Anonymity

In order to maintain user privacy a few manipulations were handled before the raw data was uploaded to the analysis repository. Any confidential information such as IP addresses were ommited, as well as any respondents that did not accept the confidentiallity agreement. 

### Pre-processing Workflow

These were the first steps applied to `surveydata_clean.rds` when the data was downloaded raw from _Survey Monkey_. 

```
# removing confidential data
survey_results <- read_csv(file = '../../survey_data/Demographic Survey.csv', skip = 1)
survey_results <- survey_results[, 10:ncol(survey_results)]

#import data
# survey_results <- read_csv(file = '../../survey_data/Demographic Survey.csv') # local path - remove identifiers beforehand

# redefine column names
colnames(survey_results) <- c('consent', 'country', 'salary_base', 'salary_expect', 'no_increase_acceptance', 
                           'living_expenses', 'savings', 'vacation', 'daily_leisure', 'consumption_goods', 
                           'sports_hobbies', 'other')

# spending categories
spending_cats <- c('living_expenses', 'savings', 'vacation', 'daily_leisure', 'consumption_goods', 
                           'sports_hobbies', 'other')

# remove no consent
survey_results <- survey_results %>% filter(consent %in% c('Yes'))

# add observation id
survey_results$id <- 1:nrow(survey_results)

# save raw clean data
saveRDS(survey_results, file = '../data/processed/surveydata_clean.rds')

# remove all traces
rm(survey_results)
```

Once the data is pre-processed, it is reimported and the columns and categories are defined. 

```{r}
# import clean data
survey_results <-  readRDS(file = '../data/processed/surveydata_clean.rds')  # local path - remove identifiers beforehand

survey_results %>% head()

# redefine column names
colnames(survey_results) <- c('consent', 'country', 'salary_base', 'salary_expect', 'no_increase_acceptance', 
                           'living_expenses', 'savings', 'vacation', 'daily_leisure', 'consumption_goods', 
                           'sports_hobbies', 'other')

# spending categories
spending_cats <- c('living_expenses', 'savings', 'vacation', 'daily_leisure', 'consumption_goods', 
                           'sports_hobbies', 'other')


```


A new variable was created as a measurement of relative expected increase in salary. This variable corresponds to the response variable of our linear regression model. The benefits of using a ratio meant that there would be less extra manipulations and potential confounding variables behind adjustments for foreign currencies. This ratio of the expected salary over the base salary of a respondent is indicative of a person's desire for financial gains. This type of metric introduces a set of confounding aspects when we do not account for specific demographic groups that would naturally behave a certain way with regards to financial inclinations. For instance, people of a certain age will typically not expect major salary increases when nearing retirement while students working while pursing a higher education degree may be recipients of a very small income in comparison to a year from now when they will enter the job market. Had the survey been organized to reach a larger demographic, more questions could have been added to delineate the confounding variables into groups including demographics such as age, occupation, etc. Another solution to handle this would have been to adjust the wording of the questions in a way that was more explicit, say instead of "" we could have specified that if they are part-time employed or a student, to imagine they are on the full-time job market when considering their qualifications and salary estimates. **IS THIS WHERE PAUL TALKS ABOUT BLOCKS** 

```{r}
# ensure any NA values are set to 0
survey_results[ , spending_cats][is.na(survey_results[,spending_cats])] <- 0

# converting char to numeric
survey_results$salary_base <- as.numeric(as.character(survey_results$salary_base))
survey_results$salary_expect <- as.numeric(as.character(survey_results$salary_expect))
ratios = survey_results$salary_expect/survey_results$salary_base

# add ratio 
survey_results <- survey_results %>% mutate(ratio = ratios)
# add ratio 
survey_results <- survey_results %>% mutate(ratio = survey_results$salary_expect/survey_results$salary_base)

```